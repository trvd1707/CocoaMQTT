CocoaMQTTGW
=============
![PodVersion](https://img.shields.io/cocoapods/v/CocoaMQTT.svg)
![Platforms](https://img.shields.io/cocoapods/p/CocoaMQTT.svg)
![License](https://img.shields.io/cocoapods/l/BadgeSwift.svg?style=flat)
![Swift version](https://img.shields.io/badge/swift-4.2-orange.svg)

MQTT v3.1.1 client library for iOS/macOS/tvOS  written with Swift 4with modifications to work 
with Objective C and to work as a MQTT gateway


Build
=====

Build with Xcode 10 / Swift 4.2


Installation
=====
### CocoaPods
Install using [CocoaPods](http://cocoapods.org) by adding this line to your Podfile:

````ruby
use_frameworks! # Add this if you are targeting iOS 8+ or using Swift
pod 'CocoaMQTTGW'  
````
Then, run the following command:

```bash
$ pod install
```

Usage
=====

Example in Example project:

```swift
let clientID = "CocoaMQTT-" + String(NSProcessInfo().processIdentifier)
let mqtt = CocoaMQTT(clientID: clientID, host: "localhost", port: 1883)
mqtt.username = "test"
mqtt.password = "public"
mqtt.willMessage = CocoaMQTTWill(topic: "/will", message: "dieout")
mqtt.keepAlive = 60
mqtt.delegate = self
mqtt.connect()

```

Now you can use clousures instead of `CocoaMQTTDelegate`:

```swift 
mqtt.didReceiveMessage = { mqtt, message, id in
	print("Message received in topic \(message.topic) with payload \(message.string!)")           
}
```

## SSL Secure

1. One-way certification

No certificate is required locally.
If you want to trust all untrust CA certificates, you can do this:

```swift
mqtt.allowUntrustCACertificate = true
```

2. Two-way certification

Need a .p12 file which is generated by a public key file and a private key file. You can generate the p12 file in the terminal:

```
openssl pkcs12 -export -clcerts -in client-cert.pem -inkey client-key.pem -out client.p12
```



CocoaMQTT
==========

```swift
/**
 * Blueprint of the MQTT client
 */
protocol CocoaMQTTClient {
    var host: String { get set }
    var port: UInt16 { get set }
    var clientID: String { get }
    var username: String? {get set}
    var password: String? {get set}
    var cleanSession: Bool {get set}
    var keepAlive: UInt16 {get set}
    var willMessage: CocoaMQTTWill? {get set}

    func connect() -> Bool
    func disconnect()
    func ping()
    
    func subscribe(_ topic: String, qos: CocoaMQTTQOS) -> UInt16
    func unsubscribe(_ topic: String) -> UInt16
    func publish(_ topic: String, withString string: String, qos: CocoaMQTTQOS, retained: Bool, dup: Bool) -> UInt16
    func publish(_ message: CocoaMQTTMessage) -> UInt16
    func completePublish(_ msgid: UInt16)
    func sendPubRec(_ msgid: UInt16)
    func sendPubRel(_ msgid: UInt16)
    
}
```


CocoaMQTTDelegate
=================

```swift
/**
 * MQTT Delegate
 */
@objc public protocol CocoaMQTTDelegate {
    /// MQTT connected with server
    // deprecated: use mqtt(_ mqtt: CocoaMQTT, didConnectAck ack: CocoaMQTTConnAck) to tell if connect to the server successfully
    // func mqtt(_ mqtt: CocoaMQTT, didConnect host: String, port: Int)
    @objc func mqtt(_ mqtt: CocoaMQTT, didConnectAck ack: CocoaMQTTConnAck)
    @objc func mqtt(_ mqtt: CocoaMQTT, didPublishMessage message: CocoaMQTTMessage, id: UInt16)
    @objc func mqtt(_ mqtt: CocoaMQTT, didPublishAck id: UInt16)
    @objc optional func mqtt(_ mqtt: CocoaMQTT, didPublishRec id: UInt16)
    @objc optional func mqtt(_ mqtt: CocoaMQTT, didPublishRel id: UInt16)
    @objc func mqtt(_ mqtt: CocoaMQTT, didReceiveMessage message: CocoaMQTTMessage, id: UInt16 )
    @objc func mqtt(_ mqtt: CocoaMQTT, didSubscribeTopic topic: String)
    @objc func mqtt(_ mqtt: CocoaMQTT, didUnsubscribeTopic topic: String)
    @objc func mqttDidPing(_ mqtt: CocoaMQTT)
    @objc func mqttDidReceivePong(_ mqtt: CocoaMQTT)
    @objc func mqttDidDisconnect(_ mqtt: CocoaMQTT, withError err: Error?)
    @objc optional func mqtt(_ mqtt: CocoaMQTT, didReceive trust: SecTrust, completionHandler: @escaping (Bool) -> Void)
    @objc optional func mqtt(_ mqtt: CocoaMQTT, didPublishComplete id: UInt16)
    @objc optional func mqtt(_ mqtt: CocoaMQTT, didStateChangeTo state: CocoaMQTTConnState)
}
```


AsyncSocket 
==========

These third-party functions are used:

* [GCDAsyncSocket](https://github.com/robbiehanson/CocoaAsyncSocket)


LICENSE
=======

MIT License (see `LICENSE`)

## Contributors

* [@andypiper](https://github.com/andypiper)
* [@turtleDeng](https://github.com/turtleDeng)
* [@trvd1707](https://github.com/trvd1707)



Author
======

- Feng Lee <feng@emqtt.io>
- CrazyWisdom <zh.whong@gmail.com>
- Alex Yu <alexyu.dc@gmail.com>


Twitter
======

https://twitter.com/emqtt

